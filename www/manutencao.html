<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manutenção</title>
    <style>
        :root {
            --primary: #2A3F54;
            --secondary: #F7F7F7;
            --background: #FFFFFF;
            --text: #333333;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--secondary);
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .form-container {
            background-color: var(--background);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 2rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .form-container.expanded {
            max-height: 1000px;
        }

        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            flex: 1;
            position: relative;
        }

        select, input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 4px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.9;
        }

        .activities-list {
            background-color: var(--background);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .activity-item {
            padding: 1rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .archived-section {
            margin-top: 2rem;
            display: none;
        }

        .archived-section.visible {
            display: block;
        }

        .toggle-archived {
            margin: 1rem 0;
        }

        .custom-period-input {
            display: none;
            margin-top: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            width: 70%;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Manutenções</h1>
        </div>
    </div>

    <div class="container">
        <button onclick="toggleForm()" class="create-button">Criar Novo Chamado</button>

        <!-- Formulário de Nova Atividade (expandível) -->
        <div class="form-container" id="activityFormContainer">
            <form id="activityForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ocorrência</label>
                        <select id="occurrence" required>
                            <option value="">Selecione</option>
                            <option>Hidraulica</option>
                            <option>Eletrica</option>
                            <option>Elevador</option>
                            <option>Gerador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Norma (opcional)</label>
                        <input type="text" id="norm">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Descrição</label>
                        <textarea id="description" required></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Equipe</label>
                        <select id="team" required>
                            <option value="">Selecione</option>
                            <option>Especialização</option>
                            <option>Capacitação</option>
                            <option>Local</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Período</label>
                        <select id="period" required onchange="toggleCustomInput()">
                            <option value="">Selecione</option>
                            <option>Segunda a sexta</option>
                            <option>Segunda a sábado</option>
                            <option>Mensal</option>
                            <option>Trimestral</option>
                            <option>Semestral</option>
                            <option>Anual</option>
                            <option>Customizado</option>
                        </select>
                        <input type="text" id="customPeriod" class="custom-period-input" 
                               placeholder="Ex: 7 dias, 2 meses, 1 ano">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Manutenção</label>
                        <select id="type" required>
                            <option value="">Selecione</option>
                            <option>Preditiva</option>
                            <option>Preventiva</option>
                            <option>Corretiva</option>
                            <option>Melhorativa</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <button type="submit">Criar Atividade</button>
                </div>
            </form>
        </div>

        <!-- Agenda de Atividades -->
        <div class="activities-list">
            <h2>Agenda de Atividades</h2>
            <button class="toggle-archived" onclick="toggleArchived()">Mostrar Arquivadas</button>
            <div id="activeActivities"></div>
            <div class="archived-section" id="archivedSection">
                <h3>Atividades Arquivadas</h3>
                <div id="archivedActivities"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Relatório -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <h3>Relatório da Atividade</h3>
            <div id="reportContent"></div>
            <button onclick="closeReport()">Fechar</button>
        </div>
    </div>

    <script>
        let activities = JSON.parse(localStorage.getItem('activities')) || [];

        function saveActivities() {
            localStorage.setItem('activities', JSON.stringify(activities));
        }

        function calculateNextDate(period, customValue = '') {
            const date = new Date();
            
            if (period === 'Customizado' && customValue) {
                const match = customValue.match(/(\d+)\s*(dias?|meses?|anos?)/i);
                if (match) {
                    const amount = parseInt(match[1]);
                    const unit = match[2].toLowerCase();
                    
                    if (unit.startsWith('dia')) date.setDate(date.getDate() + amount);
                    else if (unit.startsWith('mes')) date.setMonth(date.getMonth() + amount);
                    else if (unit.startsWith('ano')) date.setFullYear(date.getFullYear() + amount);
                }
                return date.toISOString().split('T')[0];
            }

            switch(period) {
                case 'Segunda a sexta':
                    date.setDate(date.getDate() + (date.getDay() === 5 ? 3 : 1));
                    break;
                case 'Segunda a sábado':
                    date.setDate(date.getDate() + (date.getDay() === 6 ? 2 : 1));
                    break;
                case 'Mensal': date.setMonth(date.getMonth() + 1); break;
                case 'Trimestral': date.setMonth(date.getMonth() + 3); break;
                case 'Semestral': date.setMonth(date.getMonth() + 6); break;
                case 'Anual': date.setFullYear(date.getFullYear() + 1); break;
            }
            return date.toISOString().split('T')[0];
        }

        function createActivityElement(activity, isArchived = false) {
            const div = document.createElement('div');
            div.className = 'activity-item';
            div.innerHTML = `
                <div class="activity-details">
                    <h3>${activity.occurrence}</h3>
                    <p>${activity.description}</p>
                    ${!isArchived ? `<p>Próxima execução: ${activity.nextDate}</p>` : ''}
                    <p>Período: ${activity.period} ${activity.customPeriod ? `(${activity.customPeriod})` : ''}</p>
                </div>
                <div class="activity-actions">
                    ${!isArchived ? `<button onclick="markAsDone(${activity.id})">Já realizei</button>` : ''}
                    <button onclick="generateReport(${activity.id})">Relatório</button>
                    <button onclick="removeActivity(${activity.id})">Remover</button>
                </div>
            `;
            return div;
        }

        function renderActivities() {
            const activeContainer = document.getElementById('activeActivities');
            const archivedContainer = document.getElementById('archivedActivities');
            
            activeContainer.innerHTML = '';
            archivedContainer.innerHTML = '';
            
            activities.forEach(activity => {
                if (activity.archived) {
                    archivedContainer.appendChild(createActivityElement(activity, true));
                } else {
                    activeContainer.appendChild(createActivityElement(activity));
                }
            });
        }

        function toggleForm() {
            const formContainer = document.getElementById('activityFormContainer');
            formContainer.classList.toggle('expanded');
        }

        function toggleCustomInput() {
            const period = document.getElementById('period').value;
            const customInput = document.getElementById('customPeriod');
            customInput.style.display = period === 'Customizado' ? 'block' : 'none';
            if (period !== 'Customizado') customInput.value = '';
        }

        function toggleArchived() {
            const archivedSection = document.getElementById('archivedSection');
            const button = document.querySelector('.toggle-archived');
            archivedSection.classList.toggle('visible');
            button.textContent = archivedSection.classList.contains('visible') 
                ? 'Ocultar Arquivadas' 
                : 'Mostrar Arquivadas';
        }

        // Eventos
        document.getElementById('activityForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const period = document.getElementById('period').value;
            const customPeriod = document.getElementById('customPeriod').value;
            
            const newActivity = {
                id: Date.now(),
                occurrence: document.getElementById('occurrence').value,
                norm: document.getElementById('norm').value,
                description: document.getElementById('description').value,
                team: document.getElementById('team').value,
                period: period,
                customPeriod: period === 'Customizado' ? customPeriod : '',
                type: document.getElementById('type').value,
                nextDate: calculateNextDate(period, customPeriod),
                created: new Date().toISOString(),
                archived: false
            };

            activities.push(newActivity);
            saveActivities();
            renderActivities();
            e.target.reset();
            toggleForm();
        });

        function markAsDone(id) {
            const activity = activities.find(a => a.id === id);
            activity.archived = true;
            activity.nextDate = calculateNextDate(activity.period, activity.customPeriod);
            saveActivities();
            renderActivities();
        }

        // ... (manter as outras funções como generateReport, closeReport, removeActivity)

        // Inicialização
        renderActivities();
        window.onclick = function(event) {
            const modal = document.getElementById('reportModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>